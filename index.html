

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>disptools &mdash; disptools 0.4.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> disptools
          

          
          </a>

          
            
            
              <div class="version">
                0.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">disptools</a><ul>
<li><a class="reference internal" href="#generate-displacement-fields-with-known-volume-changes">Generate displacement fields with known volume changes</a><ul>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#quick-example">Quick example</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#install">Install</a></li>
<li><a class="reference internal" href="#build-from-source">Build from source</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#build-options">Build options</a></li>
<li><a class="reference internal" href="#windows-visual-studio-and-linux">Windows (Visual Studio) and Linux</a></li>
<li><a class="reference internal" href="#windows-mingw">Windows (MinGW)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#disptools-package">disptools package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-disptools.displacements">disptools.displacements module</a></li>
<li><a class="reference internal" href="#module-disptools.drawing">disptools.drawing module</a></li>
<li><a class="reference internal" href="#module-disptools.io">disptools.io module</a></li>
<li><a class="reference internal" href="#module-disptools.measure">disptools.measure module</a></li>
<li><a class="reference internal" href="#module-disptools.predict">disptools.predict module</a></li>
<li><a class="reference internal" href="#module-disptools.simulatrophy">disptools.simulatrophy module</a></li>
<li><a class="reference internal" href="#module-disptools">Module contents</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">disptools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>disptools</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="disptools">
<h1>disptools<a class="headerlink" href="#disptools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generate-displacement-fields-with-known-volume-changes">
<h2>Generate displacement fields with known volume changes<a class="headerlink" href="#generate-displacement-fields-with-known-volume-changes" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="https://github.com/m-pilia/disptools/releases/latest"><img alt="GitHub release" src="https://img.shields.io/github/release/m-pilia/disptools.svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/disptools"><img alt="PyPI" src="https://img.shields.io/pypi/v/disptools.svg" /></a>
<a class="reference external image-reference" href="https://pypi.org/project/disptools"><img alt="Wheels" src="https://img.shields.io/pypi/wheel/disptools.svg" /></a>
<a class="reference external image-reference" href="https://github.com/m-pilia/disptools/blob/master/LICENSE"><img alt="License" src="https://img.shields.io/badge/License-MIT-blue.svg" /></a>
<a class="reference external image-reference" href="https://www.appveyor.com/"><img alt="Appveyor" src="https://ci.appveyor.com/api/projects/status/github/m-pilia/disptools?svg=true" /></a>
<p>This library provides utilities to generate and manipulate displacement fields with known volume changes. It implements three search-based algorithms for the generation of deformation fields, along with a small collection of utility functions, and provides optional GPU acceleration through a CUDA implementation.</p>
<p>The three algorithms implemented are referred as:</p>
<ul class="simple">
<li><span class="raw-html-m2r"><tt>gradient</tt></span>: a gradient descent method (default).</li>
<li><span class="raw-html-m2r"><tt>greedy</tt></span>: a greedy search method proposed in <a class="reference external" href="#1">[1]</a>.</li>
<li><span class="raw-html-m2r"><tt>matching</tt></span>: a volume matching method proposed in <a class="reference external" href="#2">[2]</a> and <a class="reference external" href="#3">[3]</a>. The implementation comes from the <a class="reference external" href="https://www.nitrc.org/projects/atrophysim">PREDICT atrophysim tool</a>.</li>
</ul>
<p>The library is built on top of SimpleITK, in order to provide a simple yet powerful set of functionalities for image analysis. Images stored as numpy arrays can be easily converted from and to <a class="reference external" href="http://simpleitk.github.io/SimpleITK-Notebooks/01_Image_Basics.html">SimpleITK</a> and <a class="reference external" href="https://blog.kitware.com/convert-itk-data-structures-to-numpy-arrays/">ITK</a> image objects.</p>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>The complete documentation for this package is available on <a class="reference external" href="https://martinopilia.com/disptools">https://martinopilia.com/disptools</a>.</p>
</div>
<div class="section" id="quick-example">
<h3>Quick example<a class="headerlink" href="#quick-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">SimpleITK</span> <span class="kn">as</span> <span class="nn">sitk</span>
<span class="kn">import</span> <span class="nn">disptools.displacements</span> <span class="kn">as</span> <span class="nn">dsp</span>
<span class="kn">import</span> <span class="nn">disptools.drawing</span> <span class="kn">as</span> <span class="nn">drw</span>

<span class="c1"># Create an example Jacobian map</span>
<span class="c1"># A spherical ROI with a Jacobian of 1.1 (expansion)</span>
<span class="n">jacobian</span> <span class="o">=</span> <span class="n">drw</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">fg_val</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">bg_val</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># Create a binary mask for the ROI</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">drw</span><span class="o">.</span><span class="n">create_sphere</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># Generate the displacement</span>
<span class="n">displacement</span> <span class="o">=</span> <span class="n">dsp</span><span class="o">.</span><span class="n">displacement</span><span class="p">(</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>

<span class="c1"># Check the correctness of the result within the ROI</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">jacobian</span> <span class="o">-</span> <span class="n">dsp</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">sitk</span><span class="o">.</span><span class="n">Mask</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>A 3D rendering of the resulting displacement field with <a class="reference external" href="https://www.paraview.org/">ParaView</a>, and a visualisation of the the error on the Jacobian within the ROI:</p>
<p><span class="raw-html-m2r"><img src="sphinx/img/example_2.png" alt="displacement" width=45% /></span> <span class="raw-html-m2r"><img src="sphinx/img/example_1.png" alt="error" width=45% /></span></p>
</div>
<div class="section" id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<p>The project is structured in three layers:</p>
<ul class="simple">
<li>a pure standard <a class="reference external" href="https://en.wikipedia.org/wiki/C99">C99</a> library (whose headers are in <span class="raw-html-m2r"><tt>src/headers</tt></span>), with no external dependencies, implementing the core algorithms for the generation of deformation fields. It is a standalone library that can be directly included in a C or C++ project. It is paired with an optional <a class="reference external" href="https://en.wikipedia.org/wiki/CUDA">CUDA</a> library, whose headers are in <span class="raw-html-m2r"><tt>cuda/headers</tt></span>, that depends on <span class="raw-html-m2r"><tt>src/headers</tt></span> and provides a GPGPU implementation of the key routines.</li>
<li>a <a class="reference external" href="https://docs.python.org/3.6/extending/extending.html">Python C extension</a> package <span class="raw-html-m2r"><tt>_disptools</tt></span> (whose source is in the file <span class="raw-html-m2r"><tt>python_c_extension/_disptools.c</tt></span>), providing a bare Python wrapper to the aforementioned library, using the <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.14.0/reference/c-api.html">NumPy C API</a> to pass arrays. This can be directly included in a Python project with no dependencies other than NumPy.</li>
<li>a Python package (<span class="raw-html-m2r"><tt>disptools</tt></span>), that wraps the <span class="raw-html-m2r"><tt>_disptools</tt></span> package providing file IO (through SimpleITK) and implementing high-level features (such as the multi-resolution framework) and auxiliary utilities and functions.<ul>
<li><span class="raw-html-m2r"><tt>disptools.displacements</tt></span>: module providing the main functions for the generation and manipulation of displacement fields.</li>
<li><span class="raw-html-m2r"><tt>disptools.drawing</tt></span>: collection of utilities to create test images.</li>
<li><span class="raw-html-m2r"><tt>disptools.io</tt></span>: collection of utilities to read and write to file.</li>
<li><span class="raw-html-m2r"><tt>disptools.measure</tt></span>: collection of utilities to measure some image features.</li>
<li><span class="raw-html-m2r"><tt>disptools.simulatrophy</tt></span>: routines to interface with the <a class="reference external" href="https://github.com/Inria-Asclepios/simul-atrophy">Simul&#64;atrophy</a> tool.</li>
<li><span class="raw-html-m2r"><tt>disptools.predict</tt></span>: routines to interface with the <a class="reference external" href="https://www.nitrc.org/projects/atrophysim">PREDICT</a> tool.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<p>This package is available on <a class="reference external" href="https://pypi.org/project/disptools">PyPI</a> both as source distribution and as a Windows pre-compiled binary wheel. You can install it with <span class="raw-html-m2r"><tt>pip</tt></span>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m pip install disptools
</pre></div>
</div>
</div>
<div class="section" id="build-from-source">
<h3>Build from source<a class="headerlink" href="#build-from-source" title="Permalink to this headline">¶</a></h3>
<div class="section" id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<p>The library is a cross-platform Python 3.5+ package, with a compiled C extension. The Python dependencies are:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/numpy/numpy">numpy</a> (<a class="reference external" href="https://pypi.python.org/pypi/numpy">pypi package</a>)</li>
<li><a class="reference external" href="https://github.com/scipy/scipy">scipy</a> (<a class="reference external" href="https://pypi.org/pypi/scipy">pypi package</a>)</li>
<li><a class="reference external" href="https://github.com/SimpleITK/SimpleITK">SimpleITK</a> (<a class="reference external" href="https://pypi.org/pypi/SimpleITK">pypi package</a>)</li>
</ul>
<p>Build dependencies are a standard C compiler (tested with gcc 8.2 on Linux, mingw-w64 7.2 and MSVC 19 on Windows 10), <a class="reference external" href="https://cmake.org/">CMake</a>, the <a class="reference external" href="https://pypi.python.org/pypi/numpy">numpy</a> and the <a class="reference external" href="https://pypi.python.org/pypi/setuptools">setuptools</a> packages. <a class="reference external" href="https://pypi.python.org/pypi/scikit-build">scikit-build</a> may be required to build the other Python dependencies.</p>
<p>Some optional dependencies are required only for a limited set of features, and the package should build and run without them:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/InsightSoftwareConsortium/ITK">itk</a> (<a class="reference external" href="https://pypi.org/project/itk">pypi package</a>): for <span class="raw-html-m2r"><tt>disptools.drawing.sitk_to_itk</tt></span></li>
<li><a class="reference external" href="https://github.com/Kitware/VTK">vtk</a> (<a class="reference external" href="https://pypi.org/project/vtk">pypi package</a>): for <span class="raw-html-m2r"><tt>disptools.io.write_vtk_points</tt></span></li>
<li><a class="reference external" href="https://github.com/dabeaz/ply">ply</a> (<a class="reference external" href="https://pypi.org/project/ply">pypi package</a>): for <span class="raw-html-m2r"><tt>disptools.io.read_elastix_parameters</tt></span></li>
<li><a class="reference external" href="https://github.com/scikit-image/scikit-image">scikit-image</a> (<a class="reference external" href="https://pypi.org/project/scikit-image">pypi package</a>): for <span class="raw-html-m2r"><tt>disptools.drawing.extract_slice</tt></span>, and to run the unit tests</li>
</ul>
</div>
<div class="section" id="build-options">
<h4>Build options<a class="headerlink" href="#build-options" title="Permalink to this headline">¶</a></h4>
<p>The following build flags are recognised by <span class="raw-html-m2r"><tt>setup.py</tt></span>:</p>
<ul class="simple">
<li><span class="raw-html-m2r"><tt>--opt</tt></span>: enable non-portable optimisations.</li>
<li><span class="raw-html-m2r"><tt>--debug</tt></span>: disable optimisations, compile with debug symbols.</li>
<li><span class="raw-html-m2r"><tt>--cuda</tt></span>: enable CUDA support.</li>
</ul>
<p>Additional flags starting with <span class="raw-html-m2r"><tt>-D</tt></span> are also accepted and passed directly to <span class="raw-html-m2r"><tt>CMake</tt></span>.</p>
</div>
<div class="section" id="windows-visual-studio-and-linux">
<h4>Windows (Visual Studio) and Linux<a class="headerlink" href="#windows-visual-studio-and-linux" title="Permalink to this headline">¶</a></h4>
<p>Install the dependencies with your favourite package manager. For example, with <span class="raw-html-m2r"><tt>pip</tt></span>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m pip install scikit-build numpy scipy SimpleITK
</pre></div>
</div>
<p>The package provides a <span class="raw-html-m2r"><tt>setuptools</tt></span> based install script. To install the library, run from the project root folder</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 setup.py install
</pre></div>
</div>
<p>which should build the C extension and install the Python package.</p>
</div>
<div class="section" id="windows-mingw">
<h4>Windows (MinGW)<a class="headerlink" href="#windows-mingw" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">First, be sure that <a class="reference external" href="https://mingw-w64.org">mingw</a>, CMake and Python are installed and their executables <a class="reference external" href="https://docs.python.org/3/using/windows.html#excursus-setting-environment-variables">are in your PATH</a>.</p>
</li>
<li><p class="first">Ensure that <span class="raw-html-m2r"><tt>gcc</tt></span> is working correctly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; gcc --version
gcc (x86_64-posix-seh-rev1, Built by MinGW-W64 project) 7.2.0
Copyright (C) 2017 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</pre></div>
</div>
</li>
<li><p class="first">Ensure that <span class="raw-html-m2r"><tt>distutils</tt></span> correctly recognises your version of Visual Studio (even when using <span class="raw-html-m2r"><tt>mingw</tt></span>). Open the file <span class="raw-html-m2r"><tt>C:\Users\yourname\AppData\Local\Programs\Python\Python3x\Lib\distutils\cygwinccompiler.py</tt></span> (the exact location may vary according to your setup) and check that your version of Visual Studio is present in the function <span class="raw-html-m2r"><tt>get_msvcr()</tt></span>; if not, adjust it according to the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_msvcr</span><span class="p">():</span>
 <span class="sd">&quot;&quot;&quot;Include the appropriate MSVC runtime library if Python was built</span>
<span class="sd"> with MSVC 7.0 or later.</span>
<span class="sd"> &quot;&quot;&quot;</span>
 <span class="n">msc_pos</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MSC v.&#39;</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">msc_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
     <span class="n">msc_ver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="n">msc_pos</span><span class="o">+</span><span class="mi">6</span><span class="p">:</span><span class="n">msc_pos</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span>
     <span class="k">if</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1300&#39;</span><span class="p">:</span>
         <span class="c1"># MSVC 7.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr70&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1310&#39;</span><span class="p">:</span>
         <span class="c1"># MSVC 7.1</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr71&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1400&#39;</span><span class="p">:</span>
         <span class="c1"># VS2005 / MSVC 8.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr80&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1500&#39;</span><span class="p">:</span>
         <span class="c1"># VS2008 / MSVC 9.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr90&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1600&#39;</span><span class="p">:</span>
         <span class="c1"># VS2010 / MSVC 10.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr100&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1700&#39;</span><span class="p">:</span>
         <span class="c1"># Visual Studio 2012 / Visual C++ 11.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr110&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1800&#39;</span><span class="p">:</span>
         <span class="c1"># Visual Studio 2013 / Visual C++ 12.0</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;msvcr120&#39;</span><span class="p">]</span>
     <span class="k">elif</span> <span class="n">msc_ver</span> <span class="o">==</span> <span class="s1">&#39;1900&#39;</span><span class="p">:</span>
         <span class="c1"># Visual Studio 2015 / Visual C++ 14.0</span>
         <span class="c1"># &quot;msvcr140.dll no longer exists&quot; http://blogs.msdn.com/b/vcblog/archive/2014/06/03/visual-studio-14-ctp.aspx</span>
         <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;vcruntime140&#39;</span><span class="p">]</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown MS Compiler version </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">msc_ver</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Ensure that the library <span class="raw-html-m2r"><tt>vcruntime140.dll</tt></span> is present in your library path. Otherwise, download it and place it in <span class="raw-html-m2r"><tt>C:\Users\yourname\AppData\Local\Programs\Python\Python3x\libs</tt></span> (the exact path may vary according to your setup).</p>
</li>
<li><p class="first">Install the dependencies:</p>
<div class="highlight-cmd notranslate"><div class="highlight"><pre><span></span>&gt; python -m pip install scikit-build numpy scipy SimpleITK
</pre></div>
</div>
</li>
<li><p class="first">Clone the sources of this package with <span class="raw-html-m2r"><tt>git</tt></span>, or download and extract them as a <span class="raw-html-m2r"><tt>zip</tt></span> archive. Move to the root folder of the sources (<span class="raw-html-m2r"><tt>C:\Users\yourname\disptools</tt></span> in this example), specify the right compiler, and launch the setup script to build and install the package.</p>
<div class="highlight-cmd notranslate"><div class="highlight"><pre><span></span>&gt; cd C:\Users\yourname\disptools
&gt; python setup.py setopt --command=build --option=compiler --set-value=mingw32
&gt; python setup.py install
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><span class="raw-html-m2r"><a id="1"></a></span>[1] van Eede, M. C., Scholz, J., Chakravarty, M. M., Henkelman, R. M., and Lerch, J. P. <em>Mapping registration sensitivity in MR mouse brain images.</em> Neuroimage 82 (2013), 226–236.</li>
<li><span class="raw-html-m2r"><a id="2"></a></span>[2] Karaçali, B., and Davatzikos, C. <em>Estimating topology preserving and smooth displacement fields.</em> IEEE Transactions on Medical Imaging 23, 7 (2004), 868–880.</li>
<li><span class="raw-html-m2r"><a id="3"></a></span>[3] Karaçali, B., and Davatzikos, C. <em>Simulation of tissue atrophy using a topology preserving transformation model.</em> IEEE transactions on medical imaging 25, 5 (2006), 649–652.</li>
</ul>
</div>
<div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>The software is distributed under the MIT license.</p>
</div>
</div>
</div>
<div class="section" id="disptools-package">
<h1>disptools package<a class="headerlink" href="#disptools-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-disptools.displacements">
<span id="disptools-displacements-module"></span><h2>disptools.displacements module<a class="headerlink" href="#module-disptools.displacements" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.displacements.average_jacobian">
<code class="descclassname">disptools.displacements.</code><code class="descname">average_jacobian</code><span class="sig-paren">(</span><em>input_filenames_pattern</em>, <em>epsilon=1e-05</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#average_jacobian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.average_jacobian" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the average of a set of Jacobians.</p>
<p>This function reads a collection of Jacobian maps from files (any format
readable by SimpleITK) and computes their average Jacobian (defined as the
geometric mean computed under logarithm). It accepts a string argument
containing a <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob pattern</a> to the input files, and a second optional
argument setting a minimum threshold for the Jacobian.</p>
<p>For instance, assuming there is a folder <code class="docutils literal notranslate"><span class="pre">/home/user/my_jacobians</span></code>
containing a set of Jacobian maps in <code class="docutils literal notranslate"><span class="pre">vtk</span></code> format, the average can
be computed with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">average_jacobian</span> <span class="o">=</span> <span class="n">disptools</span><span class="o">.</span><span class="n">displacements</span><span class="o">.</span><span class="n">average_jacobian</span><span class="p">(</span><span class="s1">&#39;/home/user/my_jacobians/*.vtk&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The average Jacobian is defined as the geometric mean computed under
logarithm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>input_filenames_pattern</strong> (<em>str</em>) – A glob pattern for the  displacement files in a format
readable by SimpleITK.</li>
<li><strong>epsilon</strong> (<em>float</em>) – A lower threshold for the Jacobian, all values below <cite>epsilon</cite>
will be replaced with <cite>epsilon</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The geometric mean of the input Jacobian maps.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.average_jacobian_from_displacements">
<code class="descclassname">disptools.displacements.</code><code class="descname">average_jacobian_from_displacements</code><span class="sig-paren">(</span><em>input_filenames_pattern</em>, <em>epsilon=1e-05</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#average_jacobian_from_displacements"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.average_jacobian_from_displacements" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the average Jacobian of a set of displacement fields.</p>
<p>This function reads a collection of displacement fields from files
(<code class="docutils literal notranslate"><span class="pre">rvf</span></code> or any other format readable by SimpleITK) and computes
the average Jacobian of the deformation associated to them
(defined as the geometric mean computed under logarithm).
It accepts a string argument containing a <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob pattern</a> to the
input displacement files, and a second optional argument setting
a minimum threshold for the Jacobian.</p>
<p>For instance, assuming there is a folder <code class="docutils literal notranslate"><span class="pre">/home/user/my_displacements</span></code>
containing a set of displacement fields in <code class="docutils literal notranslate"><span class="pre">vtk</span></code> format, the average
Jacobian can be computed with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">average_jacobian</span> <span class="o">=</span> <span class="n">disptools</span><span class="o">.</span><span class="n">displacements</span><span class="o">.</span><span class="n">average_jacobian_from_displacements</span><span class="p">(</span><span class="s1">&#39;/home/user/my_jacobians/*.vtk&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The average Jacobian is defined as the geometric mean computed under
logarithm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>input_filenames_pattern</strong> (<em>str</em>) – A glob pattern for the  displacement files in RVF or another
format readable by SimpleITK.</li>
<li><strong>epsilon</strong> (<em>float</em>) – Minimum threshold for the Jacobian, all values below <cite>epsilon</cite>
will be replaced with <cite>epsilon</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The average Jacobian of the given displacements.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.compose_displacements">
<code class="descclassname">disptools.displacements.</code><code class="descname">compose_displacements</code><span class="sig-paren">(</span><em>*fields</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#compose_displacements"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.compose_displacements" title="Permalink to this definition">¶</a></dt>
<dd><p>Compose multiple displacement fields.</p>
<p>Compute the composition pairwise and iteratively. For a couple
of displacements <img class="math" src="images/math/a5046a27fb20484be8144bd8f9e3a76c52577923.png" alt="d_1"/> and <img class="math" src="images/math/6615979d4e36d5f55b0205c5d6b1bba5d552f8c5.png" alt="d_2"/>
associated to the transforms <img class="math" src="images/math/09968cb620b9b121ddcc33bb90eab038355375ab.png" alt="f_1"/> and <img class="math" src="images/math/a23addf1349384bc83f74ce7c550fe98bbdc2b48.png" alt="f_2"/>, the
composition</p>
<div class="math">
<p><img src="images/math/b09d3b920551b0ad1d235e3a18d9bd188d2826eb.png" alt="(f_2 \circ f_1) (x) = f_2(f_1(x))"/></p>
</div><p>is obtained by resampling <img class="math" src="images/math/6615979d4e36d5f55b0205c5d6b1bba5d552f8c5.png" alt="d_2"/> with <img class="math" src="images/math/a5046a27fb20484be8144bd8f9e3a76c52577923.png" alt="d_1"/> and then
summing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fields</strong> (<em>sitk.Image</em>) – Variadic list of displacement fields.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The composition of the input displacement fields.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.decompose_displacements">
<code class="descclassname">disptools.displacements.</code><code class="descname">decompose_displacements</code><span class="sig-paren">(</span><em>field1</em>, <em>field2</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#decompose_displacements"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.decompose_displacements" title="Permalink to this definition">¶</a></dt>
<dd><p>Decompose two displacement fields.</p>
<p>Given two displacement fields <img class="math" src="images/math/a5046a27fb20484be8144bd8f9e3a76c52577923.png" alt="d_1"/> and <img class="math" src="images/math/6615979d4e36d5f55b0205c5d6b1bba5d552f8c5.png" alt="d_2"/>
associated to the transforms <img class="math" src="images/math/09968cb620b9b121ddcc33bb90eab038355375ab.png" alt="f_1"/> and <img class="math" src="images/math/a23addf1349384bc83f74ce7c550fe98bbdc2b48.png" alt="f_2"/>,
find a third displacement <img class="math" src="images/math/35e4644c96bd0f67635d9f33163cbee23785aef6.png" alt="d_3"/> associated to the
transform <img class="math" src="images/math/e0c4d6998d53a168794001253399f772ef4dffe4.png" alt="f_3"/>, such that</p>
<div class="math">
<p><img src="images/math/ca28ebbef4e4029b5cd2ee129d7d9e8b16dd0ff6.png" alt="f_1 &amp;= f_3 \circ f_2 \\
d_1(x) &amp;= d_2(x) + d_3(d_2(x))"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>field1</strong> (<em>sitk.Image</em>) – Total displacement.</li>
<li><strong>field2</strong> (<em>sitk.Image</em>) – Component to be decomposed from the total displacement.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A vector image representing a displacement field such
that its composition with the second argument gives
the first argument.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.deformation_to_displacement">
<code class="descclassname">disptools.displacements.</code><code class="descname">deformation_to_displacement</code><span class="sig-paren">(</span><em>deformation</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#deformation_to_displacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.deformation_to_displacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a deformation field to a displacement field.</p>
<p>A deformation field <img class="math" src="images/math/3cf5aa5abe312e6fd4996975341a43aa566e8d8d.png" alt="D"/> is given by the sum of the identity
transform and a displacement field <img class="math" src="images/math/b9d10b54744d07746b97f53c55eb98046fd76c8c.png" alt="d"/>:</p>
<div class="math">
<p><img src="images/math/d8d25ed1559c746b6dc4314c73e804241735bd60.png" alt="D(x) = x + d(x)"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>deformation</strong> – Input deformation field.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Displacement field associated to the deformation.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.displacement">
<code class="descclassname">disptools.displacements.</code><code class="descname">displacement</code><span class="sig-paren">(</span><em>jacobian</em>, <em>*</em>, <em>levels=1</em>, <em>pad=0</em>, <em>redistribute=False</em>, <em>mask=None</em>, <em>initial_guess=None</em>, <em>epsilon=0.000999</em>, <em>tolerance=0.2</em>, <em>it_max=50000</em>, <em>alpha=1.2</em>, <em>beta=0.5</em>, <em>gamma=0.1</em>, <em>delta=0.001</em>, <em>zeta=10.0</em>, <em>theta=1e-06</em>, <em>iota=1e-09</em>, <em>strict=False</em>, <em>eta=0.1</em>, <em>eta_max=0.4</em>, <em>algorithm='gradient'</em>, <em>gpu_id=-1</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#displacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.displacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a displacement field that realises a given Jacobian.</p>
<p>Given a 3D scalar image encoding a Jacobian map, compute a
3D vector image encoding a vector field whose Jacobian map
matches the input up to a certain tolerance.
The three algorithms provided are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gradient</span></code>: a gradient descent method (default).</li>
<li><code class="docutils literal notranslate"><span class="pre">greedy</span></code>: a greedy search method based on the method proposed in <a class="footnote-reference" href="#id17" id="id14">[1]</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">matching</span></code>: a volume matching routine based on gradient descent,
published in <a class="footnote-reference" href="#id18" id="id15">[2]</a> and <a class="footnote-reference" href="#id19" id="id16">[3]</a>. The implementation comes from
the <a class="reference external" href="https://www.nitrc.org/projects/atrophysim">atrophysim tool</a>.</li>
</ul>
<p>The initial value of the step length in the gradient descent is
given by the parameter <code class="docutils literal notranslate"><span class="pre">eta</span></code>. The <code class="docutils literal notranslate"><span class="pre">gradient</span></code> and <code class="docutils literal notranslate"><span class="pre">matching</span></code>
algorithms use an <a class="reference external" href="https://en.wikipedia.org/wiki/Wolfe_conditions">Armijo condition</a> to control the step length,
in the form</p>
<div class="math">
<p><img src="images/math/f86c130f621761dc3ec4e61348c704312d0eb47f.png" alt="E(d - \eta \nabla E(d)) - E(d) \le -\gamma \eta ||\nabla E(d)||^2"/></p>
</div><p>where <img class="math" src="images/math/b9d10b54744d07746b97f53c55eb98046fd76c8c.png" alt="d"/> is the displacement, <img class="math" src="images/math/4b6222b865b812d2a59368cd1629eed6b54454d5.png" alt="E"/> the loss function,
<img class="math" src="images/math/5635a7c34414599c2452d72430811e816b460335.png" alt="\eta"/> the current step length, and <img class="math" src="images/math/a9cab5a99c33c86c7ef9496a7dd174b8c484dbe6.png" alt="\gamma \in (0, 1)"/> a
parameter of the condition. At each iteration the step length is increased
multiplying it by <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, and if the Armijo condition is not met after
the update, <code class="docutils literal notranslate"><span class="pre">eta</span></code> is decreased multiplying it by <code class="docutils literal notranslate"><span class="pre">beta</span></code> until the
truth of the inequality in the Armijo condition is restored. A maximum
value for <code class="docutils literal notranslate"><span class="pre">eta</span></code> can be set through the parameter <code class="docutils literal notranslate"><span class="pre">eta_max</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gradient</span></code> and <code class="docutils literal notranslate"><span class="pre">matching</span></code> algorithms have a regularisation term
that penalises values of the Jacobian below a certain threshold, given
by <code class="docutils literal notranslate"><span class="pre">delta</span></code>. The importance of the regularisation term is controlled
by the parameter <code class="docutils literal notranslate"><span class="pre">zeta</span></code> (set to <code class="docutils literal notranslate"><span class="pre">0</span></code> to have no regularisation).</p>
<p>Termination is controlled by a condition on the improvement on the result
and one on the step length. If the percentual improvement of the cost
drops below the value given by <code class="docutils literal notranslate"><span class="pre">theta</span></code>, the algorithm terminates.
Termination happens also if the step length becomes smaller than
<code class="docutils literal notranslate"><span class="pre">iota</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The displacement is generally not accurate on image boundary voxels.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The C verbose output is written to <cite>stdout</cite>. If you want to capture
it from within Python, the <a class="reference external" href="https://github.com/minrk/wurlitzer">wurlitzer package</a> might be helpful.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This function calls a C routine which cannot be interrupted from
the REPL.</p>
</div>
<p class="rubric">References</p>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[1]</a></td><td>van Eede, M. C., Scholz, J., Chakravarty, M. M., Henkelman, R. M., and Lerch, J. P.
“Mapping registration sensitivity in MR mouse brain images.” Neuroimage 82 (2013), 226–236.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[2]</a></td><td>Karaçali, B., and Davatzikos, C. “Estimating topology preserving and smooth displacement fields.”
IEEE Transactions on Medical Imaging 23, 7 (2004), 868–880.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[3]</a></td><td>Karaçali, B., and Davatzikos, C. “Simulation of tissue atrophy using a topology preserving
transformation model.” IEEE transactions on medical imaging 25, 5 (2006), 649–652.</td></tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>jacobian</strong> (<em>sitk.Image</em>) – Input Jacobian.</li>
<li><strong>levels</strong> (<em>int</em>) – Number of levels in the multi-resolution pyramid; the size of
the image along each direction is halven at each level.</li>
<li><strong>pad</strong> (<em>int</em>) – Thickness of the zero-padding around the volume (0 for
the mask, 1.0 for the Jacobian) to be used during the
computation. The padding is removed before returning the result.</li>
<li><strong>redistribute</strong> (<em>bool</em>) – Redistribute the volume change inside the mask to the background.</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Binary mask for the region of interest.</li>
<li><strong>initial_guess</strong> (<em>sitk.Image</em>) – Initial estimation of the solution. The default is a null
displacement field.</li>
<li><strong>epsilon</strong> (<em>float</em>) – A floating point value, representing the tolerance per
voxel on the Jacobian of the resulting field.</li>
<li><strong>tolerance</strong> (<em>float</em>) – Tolerance on Jacobian outside the mask.</li>
<li><strong>it_max</strong> (<em>Union[int, List[int]]</em>) – Maximum number of iterations allowed. If it is a list, its
length must match the number of levels in the multi-resolution
pyramid, and each value is used for a single level, with the
first element of the list representing the level with lowest
resolution. If it is a scalar, then the same number of
iterations is used for all pyramid levels.</li>
<li><strong>alpha</strong> (<em>float</em>) – Coefficient that controls the increase of the step length.</li>
<li><strong>beta</strong> (<em>float</em>) – Coefficient that controls the decrease of the step length.</li>
<li><strong>gamma</strong> (<em>float</em>) – Armijo-Goldstein parameter.</li>
<li><strong>delta</strong> (<em>float</em>) – Lower threshold for Jacobian regularisation.</li>
<li><strong>zeta</strong> (<em>float</em>) – Weight for the regularisation term.</li>
<li><strong>theta</strong> (<em>float</em>) – Terminate if the percentage improvement of the cost per
iteration drops below this value.</li>
<li><strong>iota</strong> (<em>float</em>) – Terminate if the step length drops below this value.</li>
<li><strong>strict</strong> (<em>bool</em>) – If True, reject iterations that not decrease the maximum
voxel error.</li>
<li><strong>eta</strong> (<em>float</em>) – Initial step length.</li>
<li><strong>eta_max</strong> (<em>float</em>) – Maximum step length allowed.</li>
<li><strong>algorithm</strong> (<em>str</em>) – Algorithm to generate the field, one of <cite>greedy</cite>, <cite>gradient</cite>, or <cite>matching</cite>.</li>
<li><strong>gpu_id</strong> (<em>int</em>) – Id of the CUDA device used to run the GPU implementation. If
equal to <cite>-1</cite>, the CPU implementation is used instead. Requires
a build of disptools with CUDA support enabled.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A displacement field whose Jacobian matches the input.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.field_zero_padding">
<code class="descclassname">disptools.displacements.</code><code class="descname">field_zero_padding</code><span class="sig-paren">(</span><em>field</em>, <em>size_x=(1</em>, <em>1)</em>, <em>size_y=(1</em>, <em>1)</em>, <em>size_z=(1</em>, <em>1)</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#field_zero_padding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.field_zero_padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a zero padding to a vector field.</p>
<p>Set the zero padding manually, since <cite>sitk.ConstantPad()</cite> does not
support vector images.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>field</strong> (<em>sitk.Image</em>) – Input vector field.</li>
<li><strong>size_x</strong> (<em>(int, int)</em>) – Amount of padding at the beginning and end of x direction.</li>
<li><strong>size_y</strong> (<em>(int, int)</em>) – Amount of padding at the beginning and end of y direction.</li>
<li><strong>size_z</strong> (<em>(int, int)</em>) – Amount of padding at the beginning and end of z direction.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A padded vector field.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.inverse_consistency_error">
<code class="descclassname">disptools.displacements.</code><code class="descname">inverse_consistency_error</code><span class="sig-paren">(</span><em>forward</em>, <em>backward</em>, <em>mask=None</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#inverse_consistency_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.inverse_consistency_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the inverse consistency error (ICE).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>forward</strong> (<em>sitk.Image</em>) – A displacement from the registration (maps from
reference space to moving image space).</li>
<li><strong>backward</strong> (<em>sitk.Image</em>) – A displacement from the inverse registration (maps
from moving image space to reference space)</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – ROI in the reference image space</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><em>sitk.Image</em> – Map of the average inverse consistency error magnitude.</li>
<li><em>float</em> – Average inverse consistency error.</li>
<li><em>float</em> – Maximum inverse consistency error.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.invert_displacement_padded">
<code class="descclassname">disptools.displacements.</code><code class="descname">invert_displacement_padded</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#invert_displacement_padded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.invert_displacement_padded" title="Permalink to this definition">¶</a></dt>
<dd><p>Invert a displacement field using one voxel of padding in the computation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>field</strong> (<em>sitk.Image</em>) – Input displacement field.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The inverse of the displacement, computed under padding.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.jacobian">
<code class="descclassname">disptools.displacements.</code><code class="descname">jacobian</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#jacobian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.jacobian" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the Jacobian map of a vector field.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>field</strong> (<em>sitk.Image</em>) – Input vector field.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The Jacobian of the given vector field.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.jacobian_to_volume_change">
<code class="descclassname">disptools.displacements.</code><code class="descname">jacobian_to_volume_change</code><span class="sig-paren">(</span><em>jacobian</em>, <em>epsilon=1e-05</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#jacobian_to_volume_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.jacobian_to_volume_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a Jacobian map to a volume change map.</p>
<p>A volume change map is defined as</p>
<div class="math">
<p><img src="images/math/26cc47f0fe2fa709340c278a2372283f6211c0c5.png" alt="VC[f](x) =
\begin{cases}
    1 - \frac{1}{J[f](x)}  \quad &amp;J[f](x) \in (0,1) \\
    J[f](x) - 1            \quad &amp;J[f](x) \ge 1
\end{cases}"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>jacobian</strong> (<em>sitk.Image</em>) – Input Jacobian map.</li>
<li><strong>epsilon</strong> (<em>float</em>) – Lower threshold for the Jacobian; any value below
<cite>epsilon</cite> will be replaced with <cite>epsilon</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Volume change map associated to the input Jacobian.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.redistribute_volume_change">
<code class="descclassname">disptools.displacements.</code><code class="descname">redistribute_volume_change</code><span class="sig-paren">(</span><em>image</em>, <em>mask</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#redistribute_volume_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.redistribute_volume_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Redistribute the volume change over the image.</p>
<p>Redistribute the change of volume within the body on the background,
and enforce the total volume change over the entire image to be zero.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input Jacobian.</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Binary mask of the body volume.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A new Jacobian map with redistributed volume changes.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.regularise">
<code class="descclassname">disptools.displacements.</code><code class="descname">regularise</code><span class="sig-paren">(</span><em>jacobian</em>, <em>epsilon=1e-05</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#regularise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.regularise" title="Permalink to this definition">¶</a></dt>
<dd><p>Regularise the Jacobian, removing singularities.</p>
<p>Given a 3D scalar image, replace all the entries that are smaller
than <cite>epsilon</cite> with <cite>epsilon</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>jacobian</strong> (<em>sitk.Image</em>) – Input Jacobian map</li>
<li><strong>epsilon</strong> (<em>float</em>) – Lower threshold for the Jacobian.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Thresholded Jacobian.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.volume_change_to_jacobian">
<code class="descclassname">disptools.displacements.</code><code class="descname">volume_change_to_jacobian</code><span class="sig-paren">(</span><em>volume_change</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#volume_change_to_jacobian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.volume_change_to_jacobian" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a volume change map to a Jacobian map.</p>
<p>A volume change map is defined as</p>
<div class="math">
<p><img src="images/math/26cc47f0fe2fa709340c278a2372283f6211c0c5.png" alt="VC[f](x) =
\begin{cases}
    1 - \frac{1}{J[f](x)}  \quad &amp;J[f](x) \in (0,1) \\
    J[f](x) - 1            \quad &amp;J[f](x) \ge 1
\end{cases}"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volume_change</strong> (<em>sitk.Image</em>) – Input volume change map.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A Jacobian map associated to the input volume changes.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.displacements.warp_points_by_displacement">
<code class="descclassname">disptools.displacements.</code><code class="descname">warp_points_by_displacement</code><span class="sig-paren">(</span><em>points</em>, <em>displacement</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/displacements.html#warp_points_by_displacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.displacements.warp_points_by_displacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Warp a set of Elastix points by a displacement field.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>points</strong> (<em>np.ndarray</em>) – A <img class="math" src="images/math/893b4b543c634f80f14a67341bc864c68d46d1cc.png" alt="n \times m"/> array representing <img class="math" src="images/math/e11f2701c4a39c7fe543a6c4150b421d50f1c159.png" alt="n"/> points
with <img class="math" src="images/math/edba97b4c0d864d26e92ea7ea73767fa38eef3f7.png" alt="m"/> components.</li>
<li><strong>displacement</strong> (<em>sitk.Image</em>) – Displacement field.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">An array representing the warped points.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools.drawing">
<span id="disptools-drawing-module"></span><h2>disptools.drawing module<a class="headerlink" href="#module-disptools.drawing" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.drawing.create_sphere">
<code class="descclassname">disptools.drawing.</code><code class="descname">create_sphere</code><span class="sig-paren">(</span><em>radius</em>, <em>size=None</em>, <em>centre=None</em>, <em>fg_val=1.0</em>, <em>bg_val=0.0</em>, <em>norm=2</em>, <em>sigma=0.0</em>, <em>neighbourhood=3</em>, <em>value_function=None</em>, <em>points_file=''</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#create_sphere"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.create_sphere" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a volume image containing a spherical object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>radius</strong> (<em>float</em>) – Radius of the ball.</li>
<li><strong>size</strong> (<em>Union[int, Tuple[int, int, int]]</em>) – Size of the volume image.</li>
<li><strong>centre</strong> (<em>Tuple[float, float, float]</em>) – Centre of the sphere.</li>
<li><strong>fg_val</strong> (<em>float</em>) – Value in the foreground, i.e. inside the ball;
for variable values, see value_function.</li>
<li><strong>bg_val</strong> (<em>float</em>) – Value in the background, i.e. outside the ball.</li>
<li><strong>norm</strong> (<em>Union[int, str]</em>) – Minkovski norm used to define the metric (‘inf’
or ‘max’ to use the Chebyshev norm).</li>
<li><strong>sigma</strong> (<em>float</em>) – Sigma parameter for a Gaussian smoothing of the result.</li>
<li><strong>neighbourhood</strong> (<em>int</em>) – Neighbourhood size for a Gaussian smoothing of the result.</li>
<li><strong>value_function</strong> (<em>Callable[[float, float, float], float]</em>) – Function that associate an intensity to each point within
the ball; it takes three arguments (normalised spherical
coordinates of the point) and returns a scalar intensity;
the input is in vector form, and operations within this
function should be vectorised (e.g. using numpy functions).</li>
<li><strong>points_file</strong> (<em>str</em>) – Name of the file used to store a set of reference
points associated to the ball (empty string means to not
store the reference points).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A volume image containing a ball.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.extract_slice">
<code class="descclassname">disptools.drawing.</code><code class="descname">extract_slice</code><span class="sig-paren">(</span><em>image</em>, <em>index=None</em>, <em>axis=2</em>, <em>rescale=False</em>, <em>colormap=3</em>, <em>hsv_interpolation=False</em>, <em>window=None</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#extract_slice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.extract_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract a slice.</p>
<p>This function takes care of resampling the image on a uniform grid with
unit spacing, that can be exported to format that do not support
anisotropic voxel spacing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input image.</li>
<li><strong>index</strong> (<em>int</em>) – Integer index of the slice to extract.</li>
<li><strong>axis</strong> (<em>int</em>) – Integer index of the axis orthogonal to the slice plane.</li>
<li><strong>rescale</strong> (<em>bool</em>) – If True, do min-max rescaling of the image intensity to [0,255].</li>
<li><strong>colormap</strong> (<em>Union[int, np.ndarray]</em>) – One of the colormaps defined in sitk.ScalarToRGBColormapImageFilter,
or an $n times 4$ array of node colours for a custom colour
map, where the first column gives an intensity value and the
other three the RGB components in the range $[0,1]$ for the node
colours to be interpolated.  If None, the result will be a
grayscale image; if not None, map the intensity values to RGB
colours through the selected colormap.</li>
<li><strong>hsv_interpolation</strong> (<em>bool</em>) – If <cite>True</cite>, perform colour interpolation in HSV space when using
a custom colour map.</li>
<li><strong>window</strong> (<em>(float, float)</em>) – Tuple composed by a couple of minimum and maximum values for
intensity windowing.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A sitk.sitkUInt8 image containing the desired slice.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.float_dilate">
<code class="descclassname">disptools.drawing.</code><code class="descname">float_dilate</code><span class="sig-paren">(</span><em>image</em>, <em>dilate</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#float_dilate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.float_dilate" title="Permalink to this definition">¶</a></dt>
<dd><p>Dilate a float valued image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Image to be dilated.</li>
<li><strong>dilate</strong> (<em>int</em>) – Radius of the structuring element.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Dilated image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.mask">
<code class="descclassname">disptools.drawing.</code><code class="descname">mask</code><span class="sig-paren">(</span><em>image</em>, <em>mask</em>, <em>jacobian=False</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Mask an image (special meaning for Jacobian maps).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input image to be masked (possibly float).</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Mask (possibly float).</li>
<li><strong>jacobian</strong> (<em>bool</em>) – If true, the background after masking is set to
one, if false to zero.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The masked image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.polar_conversion">
<code class="descclassname">disptools.drawing.</code><code class="descname">polar_conversion</code><span class="sig-paren">(</span><em>norm</em>, <em>centre</em>, <em>radius</em>, <em>x</em>, <em>y</em>, <em>z</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#polar_conversion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.polar_conversion" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Cartesian to normalised spherical coordinates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>norm</strong> (<em>Union[int, str]</em>) – Minkovski norm (‘max’ or ‘inf’ for the Chebyshev norm).</li>
<li><strong>centre</strong> (<em>Tuple[float, float, float]</em>) – Coordinates of the centre.</li>
<li><strong>radius</strong> (<em>float</em>) – Radius of the ball.</li>
<li><strong>x</strong> (<em>float</em>) – Cartesian coordinate.</li>
<li><strong>y</strong> (<em>float</em>) – Cartesian coordinate.</li>
<li><strong>z</strong> (<em>float</em>) – Cartesian coordinate.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A tuple (rho, theta, phi) of spherical coordinates with rho
normalised w.r.t. the radius of the sphere.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Tuple[int, int, int]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.scale_image">
<code class="descclassname">disptools.drawing.</code><code class="descname">scale_image</code><span class="sig-paren">(</span><em>image</em>, <em>new_size</em>, <em>interpolator=2</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#scale_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.scale_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Scale an image in a grid of given size.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – An input image.</li>
<li><strong>new_size</strong> (<em>Tuple[int, …]</em>) – A tuple of integers expressing the new size.</li>
<li><strong>interpolator</strong> (<em>int</em>) – A SimpleITK interpolator enum value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Resized image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.sin_vector_field">
<code class="descclassname">disptools.drawing.</code><code class="descname">sin_vector_field</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#sin_vector_field"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.sin_vector_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate an example of continuous vector field.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<em>int</em>) – Size of the volume image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A vector-valued volume image containing a continuous
vector field.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.drawing.sitk_to_itk">
<code class="descclassname">disptools.drawing.</code><code class="descname">sitk_to_itk</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/drawing.html#sitk_to_itk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.drawing.sitk_to_itk" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to convert an image object from SimpleITK to ITK.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data is copied to the new object (deep copy).</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<em>sitk.Image</em>) – Input image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Image in ITK format.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">any</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools.io">
<span id="disptools-io-module"></span><h2>disptools.io module<a class="headerlink" href="#module-disptools.io" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.io.make_unique_directory">
<code class="descclassname">disptools.io.</code><code class="descname">make_unique_directory</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#make_unique_directory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.make_unique_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a unique directory.</p>
<p>If a directory with the given name already exists,
a suffix in the form <cite>_x</cite> with <cite>x</cite> integer will be
added at the end of its name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<em>str</em>) – Relative or absolute path for the new directory.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A string containing the path of the new directory.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.read_elastix_parameters">
<code class="descclassname">disptools.io.</code><code class="descname">read_elastix_parameters</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#read_elastix_parameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.read_elastix_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an Elastix parameter file.</p>
<p>Read an Elastix parameter file, returning a dictionary mapping each
parameter name to a list of values. Booleans are converted to Python
<cite>bool`s, same for `int</cite> and <cite>float</cite> values. Strings do not need to be
quoted. Comments are discarded.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This function will not work if Python is allowed to discard docstrings
(e.g. due to the option -OO).</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<em>str</em>) – Name of the parameter file to be read.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary of parameters.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.read_elastix_points">
<code class="descclassname">disptools.io.</code><code class="descname">read_elastix_points</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#read_elastix_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.read_elastix_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a set of points from a file in Elastix format.</p>
<p>The points are returned as a two-dimensional numpy array, with a
row for each point and three columns, one per coordinate.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<em>str</em>) – Output file.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A <cite>n × m</cite> array containing <cite>n</cite> points with <cite>m</cite> components.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.read_rvf">
<code class="descclassname">disptools.io.</code><code class="descname">read_rvf</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#read_rvf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.read_rvf" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an RVF file.</p>
<p>Read image data from an RVF file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<em>str</em>) – Filename for the input vector field.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>result</strong> – Vector field.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.write_elastix_parameters">
<code class="descclassname">disptools.io.</code><code class="descname">write_elastix_parameters</code><span class="sig-paren">(</span><em>parameters</em>, <em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#write_elastix_parameters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.write_elastix_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Write Elastix parameters to file.</p>
<p>Write an Elastix parameter file. Parameters are passed as a dictionary
mapping each parameter name to a list of values. Python <a href="#id20"><span class="problematic" id="id21">`</span></a>bool`s, <a href="#id22"><span class="problematic" id="id23">`</span></a>int`s,
and <a href="#id24"><span class="problematic" id="id25">`</span></a>float`s are converted automatically.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>parameters</strong> (<em>dict</em>) – Dictionary of parameters.</li>
<li><strong>filename</strong> (<em>str</em>) – Name of the parameter file to be read.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.write_elastix_points">
<code class="descclassname">disptools.io.</code><code class="descname">write_elastix_points</code><span class="sig-paren">(</span><em>points</em>, <em>filename</em>, <em>point_format='point'</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#write_elastix_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.write_elastix_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a set of points to a file in Elastix format.</p>
<p>The points are passed as a two-dimensional numpy array, with a row
for each point and three columns, one per coordinate.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>points</strong> (<em>np.ndarray</em>) – A <cite>n × m</cite> array containing <cite>n</cite> points with <cite>m</cite> components.</li>
<li><strong>filename</strong> (<em>str</em>) – Output file.</li>
<li><strong>point_format</strong> (<em>str</em>) – One of ‘point’ (default) or ‘index’.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.io.write_vtk_points">
<code class="descclassname">disptools.io.</code><code class="descname">write_vtk_points</code><span class="sig-paren">(</span><em>points</em>, <em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/io.html#write_vtk_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.io.write_vtk_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a set of points to a VTK PolyData file.</p>
<p>The points are given as a numpy bidimensional array, with a
row for each point, and three columns, one per component.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>points</strong> (<em>np.ndarray</em>) – A <cite>n × m</cite> array containing <cite>n</cite> points with <cite>m</cite> components.</li>
<li><strong>filename</strong> (<em>str</em>) – Output file.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools.measure">
<span id="disptools-measure-module"></span><h2>disptools.measure module<a class="headerlink" href="#module-disptools.measure" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.measure.average_jacobian_error">
<code class="descclassname">disptools.measure.</code><code class="descname">average_jacobian_error</code><span class="sig-paren">(</span><em>jacobian</em>, <em>mask=None</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#average_jacobian_error"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.average_jacobian_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the average error between the input Jacobian and
a constant unit Jacobian map.</p>
<p>The average Jacobian error is defined as
<img class="math" src="images/math/ac413657d06160f667595e487a197a3a2dd17999.png" alt="\frac{1}{|mask|} \sum_{x \in mask} (J(x) - 1)"/></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>jacobian</strong> (<em>sitk.Image</em>) – Input Jacobian map.</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Optional binary mask, to compute the error only on a ROI.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The average Jacobian error.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.centre_of_mass">
<code class="descclassname">disptools.measure.</code><code class="descname">centre_of_mass</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#centre_of_mass"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.centre_of_mass" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the centre of mass of the image.</p>
<p>A real-valued image represents the distribution of mass, and its
centre of mass is defined as <img class="math" src="images/math/94a2d12dde6a677d3d29683db05f8ce2a9712279.png" alt="\frac{1}{\sum_p I(p)} \sum_p p I(p)"/>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<em>sitk.Image</em>) – Input image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">World coordinates (x, y, z) of the centre of mass.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.cubicity">
<code class="descclassname">disptools.measure.</code><code class="descname">cubicity</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#cubicity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.cubicity" title="Permalink to this definition">¶</a></dt>
<dd><p>Measure the cubicity of an object.</p>
<p>The cubicity is defined <a class="footnote-reference" href="#id27" id="id26">[4]</a> as the ratio between the volume of the
object and the volume of its bounding cube.
A cube has cubicity equal to 1, a sphere has cubicity pi/6, and in
general non-cubic objects have cubicity strictly lesser than 1.</p>
<p>Here the bounding cube is estimated as the cube whose side is
equal to the longest side of the oriented bounding box of the
object.</p>
<p class="rubric">References</p>
<table class="docutils footnote" frame="void" id="id27" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id26">[4]</a></td><td>O’Flannery, LJ and O’Mahony, MM, “Precise shape grading of
coarse aggregate”. Magazine of Concrete Research 51.5 (1999),
pp. 319-324.</td></tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<em>sitk.Image</em>) – Input binary (sitkUInt8) image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A floating point value of cubicity in the interval [0, 1].</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.entropy">
<code class="descclassname">disptools.measure.</code><code class="descname">entropy</code><span class="sig-paren">(</span><em>image</em>, <em>mask=None</em>, <em>bins=256</em>, <em>sigma=0.0</em>, <em>window=None</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#entropy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.entropy" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the entropy of an image.</p>
<p>The information entropy of a random variables <img class="math" src="images/math/48e58831e9742857bcdc08cc9adacceb19958e89.png" alt="X \sim p_X(x)"/>
is defined as</p>
<div class="math">
<p><img src="images/math/a75dd5c71929dc8a9ce302599e8f812f8de9570d.png" alt="H(X) = \int p_{X}(x) \log p_X(x) dx"/></p>
</div><p>Entropy is estimated by approximating the probability density with
an intensity histogram.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input image.</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Binary image masking a region of interest.</li>
<li><strong>bins</strong> (<em>int</em>) – Number of bins for the intensity histogram.</li>
<li><strong>sigma</strong> (<em>float</em>) – Standard deviation for Gaussian smoothing of the histogram
histogram. If zero, no smoothing is used.</li>
<li><strong>window</strong> (<em>Tuple[float, float]</em>) – Intensity window. If not <cite>None</cite>, then values outside the
provided window are considered outliers and excluded from the
computation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">An estimation of the information entropy of the image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.f">
<code class="descclassname">disptools.measure.</code><code class="descname">f</code><span class="sig-paren">(</span><em>image1</em>, <em>image2</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#f"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the fitting index of an input object.</p>
<p>The F measure is defined as the harmonic mean of precision and
recall:</p>
<div class="math">
<p><img src="images/math/6da2cfa91fe1d8b3a217b87e4af65b0445cf4411.png" alt="F(I_1, I_2) = \frac{2 \text{tp}}{2\text{tp} + \text{fp} + \text{fn}}"/></p>
</div><p>It is equivalent to the Sørensen-Dice coefficient, defined as two
times the measure of the intersection over the sum of the measures
of the two inputs:</p>
<div class="math">
<p><img src="images/math/ca801030b498e9f666741dab1336a0d0ddea0714.png" alt="J(I_1, I_2) = \frac{2 |I_1 \bigcap I_2|}{|I_1| + |I_2|}"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image1</strong> (<em>sitk.Image</em>) – First input binary image.</li>
<li><strong>image2</strong> (<em>sitk.Image</em>) – First input binary image.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Value of the F measure.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.fitting_index">
<code class="descclassname">disptools.measure.</code><code class="descname">fitting_index</code><span class="sig-paren">(</span><em>image</em>, <em>norm=2.0</em>, <em>centre=None</em>, <em>radius=None</em>, <em>padding=True</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#fitting_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.fitting_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the fitting index of an input object.</p>
<p>The fitting index of order <cite>p</cite> is defined as the Jaccard coefficient
computed between the input object and a p-ball centred in the object’s
centre of mass.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input binary image of the object.</li>
<li><strong>norm</strong> (<em>Union[int,str]</em>) – Order of the Minkowski norm (‘inf’ or ‘max’ to use the Chebyshev norm).</li>
<li><strong>centre</strong> (<em>Tuple[float, float, float]</em>) – Forces the p-ball to be centred in a specific point.</li>
<li><strong>radius</strong> (<em>float</em>) – Force the radius of the p-ball.</li>
<li><strong>padding</strong> (<em>bool</em>) – If <cite>True</cite>, add enough padding to be sure that the ball will entirely
fit within the volume.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Value of the fitting index.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.isovolumteric_radius">
<code class="descclassname">disptools.measure.</code><code class="descname">isovolumteric_radius</code><span class="sig-paren">(</span><em>image</em>, <em>norm</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#isovolumteric_radius"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.isovolumteric_radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the radius of a ball isovolumetric to the input object</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input binary image.</li>
<li><strong>norm</strong> (<em>Union[int,str]</em>) – Order of the Minkowski norm (‘inf’ or ‘max’ to use the Chebyshev norm).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Value of the isovolumetric radius.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.jaccard">
<code class="descclassname">disptools.measure.</code><code class="descname">jaccard</code><span class="sig-paren">(</span><em>image1</em>, <em>image2</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#jaccard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.jaccard" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the fitting index of an input object.</p>
<p>The Jaccard coefficient is defined as the measure of the
intersection over the measure of the union:</p>
<div class="math">
<p><img src="images/math/3c6f8433fb4c49f4a951c16a11d3abbf3b6cb13f.png" alt="J(I_1, I_2) = \frac{|I_1 \bigcap I_2|}{|I_1 \bigcup I_2|}"/></p>
</div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image1</strong> (<em>sitk.Image</em>) – First input binary image.</li>
<li><strong>image2</strong> (<em>sitk.Image</em>) – First input binary image.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Value of the Jaccard coefficient.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.minkowski_compactness">
<code class="descclassname">disptools.measure.</code><code class="descname">minkowski_compactness</code><span class="sig-paren">(</span><em>image</em>, <em>norm=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#minkowski_compactness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.minkowski_compactness" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the Minkovski compactness of a binary image.</p>
<p>Minkowski compactness of an object is defined as the ratio between the volume
of the object and the volume of a p-ball centred on the object’s centre of
mass, maximised agaist spatial rotations of the ball.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input binary image.</li>
<li><strong>norm</strong> (<em>Union[int,str]</em>) – Order of the Minkowski norm (‘inf’ or ‘max’ to use the Chebyshev norm).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Value of the Minkowski norm.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.mutual_information">
<code class="descclassname">disptools.measure.</code><code class="descname">mutual_information</code><span class="sig-paren">(</span><em>image1</em>, <em>image2</em>, <em>mask</em>, <em>bins=256</em>, <em>sigma=0.0</em>, <em>window=None</em>, <em>normalised=False</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#mutual_information"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.mutual_information" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the mutual information of two images.</p>
<p>The mutual information of two random variables <img class="math" src="images/math/48e58831e9742857bcdc08cc9adacceb19958e89.png" alt="X \sim p_X(x)"/> and
<img class="math" src="images/math/e3e804573c45c64317131c57666b70fb6976d68b.png" alt="Y \sim p_Y(y)"/> with joint probability distribution
<img class="math" src="images/math/28a3c3c609e53e0f5d913efe092ec1d89bb84718.png" alt="p_{XY}(x, y)"/> is defined as</p>
<div class="math">
<p><img src="images/math/e1895ffc3f04a9411a01f3ec375b2b86799d0abc.png" alt="MI(X, Y) = \iint p_{XY}(x, y) \log \frac{p_{XY}(x, y)}{p_X(x) p_Y(y)} dx dy"/></p>
</div><p>Mutual information is estimated by approximating the joint
probability density with a joint histogram for the intensity of the
two images.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first">
<li><p class="first"><strong>image1</strong> (<em>sitk.Image</em>) – Input image. Must have the same size of <cite>image2</cite>.</p>
</li>
<li><p class="first"><strong>image2</strong> (<em>sitk.Image</em>) – Input image. Must have the same size of <cite>image1</cite>.</p>
</li>
<li><p class="first"><strong>mask</strong> (<em>sitk.Image</em>) – Binary image masking a region of interest.</p>
</li>
<li><p class="first"><strong>bins</strong> (<em>Union[int, List[int, int], np.ndarray, List[np.ndarray, np.ndarray]]</em>) –</p>
<dl class="docutils">
<dt>Number of bins for the marginal intensity histograms:</dt>
<dd><ul class="first last simple">
<li>If <cite>int</cite>, use the same number of bins for both images.</li>
<li>If <cite>List[int, int]</cite>, use two different bis sizes for the two images.</li>
<li>If <cite>np.ndarray</cite>, specity the same bin edges for the two images.</li>
<li>If <cite>List[np.ndarray, np.ndarray]</cite>, specity different bin edges
for the two images.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><strong>sigma</strong> (<em>float</em>) – Standard deviation for Gaussian smoothing of the joint
histogram. If zero, no smoothing is used.</p>
</li>
<li><p class="first"><strong>window</strong> (<em>Tuple[Tuple[float, float], Tuple[float, float]]</em>) – Intensity window for the two images, in the form
<cite>[[min1, max1], [min2, max2]]</cite>. If not <cite>None</cite>, then values
outside the provided window are considered outliers and excluded
from the computation.</p>
</li>
<li><p class="first"><strong>normalised</strong> (<em>bool</em>) – If <cite>True</cite>, compute the normalised mutual information as
<img class="math" src="images/math/821fdc1abc280623d822efdb3564befe99521f37.png" alt="NMI(X, Y) = \frac{MI(X, Y)}{\sqrt{H(X) H(Y)}}"/>.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">An estimation of the mutual information for the two images.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.reject_outliers">
<code class="descclassname">disptools.measure.</code><code class="descname">reject_outliers</code><span class="sig-paren">(</span><em>data</em>, <em>k=2.5</em>, <em>absolute=True</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#reject_outliers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.reject_outliers" title="Permalink to this definition">¶</a></dt>
<dd><p>Reject outliers from an array, based on the median deviation (MD).</p>
<p>Reject as outliers all values whose deviation from the median is higher
than <img class="math" src="images/math/594ebcbbd5600cb0d94b76641d6eb0d9865742bc.png" alt="k \cdot MD"/>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>np.ndarray</em>) – Array of values.</li>
<li><strong>k</strong> (<em>float</em>) – Number of MDs for outlier rejection.</li>
<li><strong>absolute</strong> (<em>bool</em>) – If True, use absolute deviations.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">An array with the outliers removed.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.sphericity">
<code class="descclassname">disptools.measure.</code><code class="descname">sphericity</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#sphericity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.sphericity" title="Permalink to this definition">¶</a></dt>
<dd><p>Measure the sphericity of a object.</p>
<p>The sphericity is defined <a class="footnote-reference" href="#id30" id="id28">[5]</a> <a class="footnote-reference" href="#id31" id="id29">[6]</a> as the ratio between the surface of a sphere
with the same volume of the object and the surface of the object itself.</p>
<div class="math">
<p><img src="images/math/04b03a85023e4e414fef40a8bec32aacf302ac08.png" alt="\frac{\pi^{\frac{1}{3}}(6V)^{\frac{2}{3}}}{A}"/></p>
</div><p>A sphere has sphericity equal to 1, non-spherical objects have sphericity
strictly lesser than 1.</p>
<p class="rubric">References</p>
<table class="docutils footnote" frame="void" id="id30" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id28">[5]</a></td><td>Wadell, Hakon. “Volume, shape, and roundness of quartz particles.”
The Journal of Geology 43.3 (1935): 250-280.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id31" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id29">[6]</a></td><td>Lehmann, Gaëthan. “Label object representation and manipulation with ITK”
Insight Journal, July-December 2007</td></tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<em>sitk.Image</em>) – Input binary (sitkUInt8) image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A floating point value of sphericity in the interval [0, 1].</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.measure.volume_change">
<code class="descclassname">disptools.measure.</code><code class="descname">volume_change</code><span class="sig-paren">(</span><em>jacobian</em>, <em>mask=None</em>, <em>average=False</em>, <em>squared=False</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/measure.html#volume_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.measure.volume_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the volume change associated to a Jacobian map.</p>
<p>The total volume change associated to an invertible transform
<img class="math" src="images/math/875eb40014526135383caa89fd500ae40a835f56.png" alt="f"/> over a ROI <img class="math" src="images/math/cd30e0b91d2b53728ae09ccac9d857b79b3adfcb.png" alt="\Omega"/> is defined as</p>
<div class="math">
<p><img src="images/math/43d0a00de7cb030883b226c03eb3ba6697db5b90.png" alt="TVC(J) = \int_{p \in \Omega} |VC[f](x)| d\Omega"/></p>
</div><p>while the average absolute volume change is defined as</p>
<div class="math">
<p><img src="images/math/bcc114cc5371d0714a7636a136ed377d2357efe8.png" alt="AVC(J) = \frac{1}{|\Omega|} \int_{p \in \Omega} |VC[f](x)| d\Omega"/></p>
</div><p>where the volume change is defined as</p>
<div class="math">
<p><img src="images/math/26cc47f0fe2fa709340c278a2372283f6211c0c5.png" alt="VC[f](x) =
\begin{cases}
    1 - \frac{1}{J[f](x)}  \quad &amp;J[f](x) \in (0,1) \\
    J[f](x) - 1            \quad &amp;J[f](x) \ge 1
\end{cases}"/></p>
</div><p>with <img class="math" src="images/math/d90e88d92dc8535053330a74f2f5caa7591a824d.png" alt="J[f]"/> representing the Jacobian of <img class="math" src="images/math/875eb40014526135383caa89fd500ae40a835f56.png" alt="f"/>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>jacobian</strong> (<em>sitk.Image</em>) – Jacobian map of the transform.</li>
<li><strong>mask</strong> (<em>sitk.Image</em>) – Binary image masking a region of interest.</li>
<li><strong>average</strong> (<em>bool</em>) – If <code class="docutils literal notranslate"><span class="pre">true</span></code> return the average and standard deviation, otherwise
return the total.</li>
<li><strong>squared</strong> (<em>bool</em>) – If <code class="docutils literal notranslate"><span class="pre">true</span></code> return the total or average of the squared volume
change.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The total volume change.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools.predict">
<span id="disptools-predict-module"></span><h2>disptools.predict module<a class="headerlink" href="#module-disptools.predict" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.predict.create_target_volume">
<code class="descclassname">disptools.predict.</code><code class="descname">create_target_volume</code><span class="sig-paren">(</span><em>image</em>, <em>atrophy_rate</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/predict.html#create_target_volume"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.predict.create_target_volume" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a target volume map for the PREDICT tool.</p>
<p>Given an input segmentation map, create mask target volume map for the
PREDICT tool, with the given atrophy rate. The volume change in
<img class="math" src="images/math/ea9685e7f93513880e3b1f1bcba896d8e576ede3.png" alt="(x,y,z)"/> is defined over a cubic pach formed by the voxel
<img class="math" src="images/math/ea9685e7f93513880e3b1f1bcba896d8e576ede3.png" alt="(x,y,z)"/>, its three successors along the axis and their respective
successors to close the cube. Hence, if the input mask has size
<img class="math" src="images/math/53b56da6b0dfacdb01c136499691bf9bf254b770.png" alt="m \times n \times s"/>, the volume map has size
<img class="math" src="images/math/21d695d242bd4bc23daae28b9d90f62d6704c650.png" alt="(m-1) \times (n-1) \times (s-1)"/>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The output must be in np.float32, since the PREDICT tool uses
the C <cite>float</cite> type as hard-coded type.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input segmentation map.</li>
<li><strong>atrophy_rate</strong> (<em>float</em>) – Target atropy rate for the segmented ROI.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A SimpleITK image object with the target volume map.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.predict.read_deformation">
<code class="descclassname">disptools.predict.</code><code class="descname">read_deformation</code><span class="sig-paren">(</span><em>filename</em>, <em>size</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/predict.html#read_deformation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.predict.read_deformation" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a deformation field from a file in the PREDICT format</p>
<p>The deformation field is stored as binary uncompressed 32-float data.</p>
<p>PREDICT uses a different convention for the coordinates (with rows
along the <img class="math" src="images/math/276f7e256cbddeb81eee42e1efc348f3cb4ab5f8.png" alt="y"/> axis, columns along the <img class="math" src="images/math/a59f68a4202623bb859a7093f0316bf466e6f75d.png" alt="x"/> axis, and slices
along the <img class="math" src="images/math/683f2dd9129a91d21aaf1c04afa6f78b39d4cb0a.png" alt="z"/> axis), so a permutation of the components in the
result is required. The identity is subtracted in order to convert the
deformation to a displacement field.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The size of the volume is not stored within PREDICT files, so it needs
to be known and passed as an argument.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>str</em>) – Input file.</li>
<li><strong>size</strong> (<em>(int, int, int)</em>) – Size of the volume <cite>(x,y,z)</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A SimpleITK image object containing the corresponding displacement field.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.predict.read_img">
<code class="descclassname">disptools.predict.</code><code class="descname">read_img</code><span class="sig-paren">(</span><em>filename</em>, <em>size</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/predict.html#read_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.predict.read_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Read an image from file in the PREDICT format.</p>
<p>PREDICT uses a different convention for the coordinates (with rows
along the <img class="math" src="images/math/276f7e256cbddeb81eee42e1efc348f3cb4ab5f8.png" alt="y"/> axis, columns along the <img class="math" src="images/math/a59f68a4202623bb859a7093f0316bf466e6f75d.png" alt="x"/> axis, and slices
along the <img class="math" src="images/math/683f2dd9129a91d21aaf1c04afa6f78b39d4cb0a.png" alt="z"/> axis), so a permutation of the components in the
result is required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The size of the volume is not stored within PREDICT files, so it needs
to be known and passed as an argument.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>str</em>) – Input file.</li>
<li><strong>size</strong> (<em>(int, int, int)</em>) – Size of the volume <cite>(x,y,z)</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a SimpleITK image object containing the corresponding image</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.predict.write_img">
<code class="descclassname">disptools.predict.</code><code class="descname">write_img</code><span class="sig-paren">(</span><em>image</em>, <em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/predict.html#write_img"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.predict.write_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an image to file in the PREDICT format.</p>
<p>PREDICT uses a different convention for the coordinates (with rows
along the <img class="math" src="images/math/276f7e256cbddeb81eee42e1efc348f3cb4ab5f8.png" alt="y"/> axis, columns along the <img class="math" src="images/math/a59f68a4202623bb859a7093f0316bf466e6f75d.png" alt="x"/> axis, and slices
along the <img class="math" src="images/math/683f2dd9129a91d21aaf1c04afa6f78b39d4cb0a.png" alt="z"/> axis), so a permutation of the components in the
result is required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The size of the volume will not be stored within the file.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>str</em>) – Input file.</li>
<li><strong>size</strong> (<em>(int, int, int)</em>) – Size of the volume <cite>(x,y,z)</cite>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A SimpleITK image object containing the corresponding image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools.simulatrophy">
<span id="disptools-simulatrophy-module"></span><h2>disptools.simulatrophy module<a class="headerlink" href="#module-disptools.simulatrophy" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="disptools.simulatrophy.jacobian_to_atrophy_map">
<code class="descclassname">disptools.simulatrophy.</code><code class="descname">jacobian_to_atrophy_map</code><span class="sig-paren">(</span><em>image</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/simulatrophy.html#jacobian_to_atrophy_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.simulatrophy.jacobian_to_atrophy_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a Jacobian map to a atrophy map.</p>
<p>The atrophy rate <img class="math" src="images/math/bd9d9c7512c898e0a254a0882184197bc1bd9c9f.png" alt="a"/> is defined as the pointwise percentage of
volume loss, so <img class="math" src="images/math/eb2d3efbc548b649a2c29d6470b1f49da7871ded.png" alt="a = -(J-1)"/> (where <img class="math" src="images/math/ca54d3a4a8a221da5f7a13a28ec6a45b4abcc5a5.png" alt="J"/> is the Jacobian).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>image</strong> (<em>sitk.Image</em>) – Input image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Corresponding atrophy map.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">sitk.Image</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.simulatrophy.mask_to_simulatrophy_mask">
<code class="descclassname">disptools.simulatrophy.</code><code class="descname">mask_to_simulatrophy_mask</code><span class="sig-paren">(</span><em>image</em>, <em>radius=None</em>, <em>kernel=1</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/simulatrophy.html#mask_to_simulatrophy_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.simulatrophy.mask_to_simulatrophy_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a binary mask to a Simul&#64;atrophy mask.</p>
<dl class="docutils">
<dt>The mask used by Simul&#64;atrophy has five labels:</dt>
<dd><ul class="first last simple">
<li>0: skull</li>
<li>1: cerebro-spinal fluid (CSF)</li>
<li>2: gray matter</li>
<li>3: white matter</li>
<li>4: falx cerebri</li>
</ul>
</dd>
</dl>
<p>This function takes as input a binary mask, and returns another mask
in the Simul&#64;atrophy format, where the ROI of the original mask is
mapped to white matter, a surrounding region of CSF is created
around it, and the remaining is set to skull.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image</strong> (<em>sitk.Image</em>) – Input binary mask.</li>
<li><strong>radius</strong> (<em>int</em>) – Radius for the dilation, determines the amount of CSF
surrounding the ROI. If <cite>None</cite>, all the volume outside the ROI
is set to CSF.</li>
<li><strong>kernel</strong> (<em>int</em>) – Kernel used for the dilation, among the values in
<a class="reference external" href="https://itk.org/SimpleITKDoxygen/html/namespaceitk_1_1simple.html#a38998f2c7b469b1ad8e337a0c6c0697b">itk::simple::KernelEnum</a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A Simul&#64;atrophy mask constructed from the input mask.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="disptools.simulatrophy.run">
<code class="descclassname">disptools.simulatrophy.</code><code class="descname">run</code><span class="sig-paren">(</span><em>jacobian</em>, <em>mask</em>, <em>scale=None</em>, <em>sigma=2.0</em>, <em>lame=(1.0</em>, <em>1.0</em>, <em>1.0</em>, <em>1.0)</em>, <em>origin=None</em>, <em>size=None</em>, <em>executable=None</em><span class="sig-paren">)</span><a class="reference internal" href="modules/disptools/simulatrophy.html#run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#disptools.simulatrophy.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper around Simul&#64;atrophy.</p>
<p>Use Simul&#64;atrophy <a class="footnote-reference" href="#id33" id="id32">[7]</a> to generate a displacement that realises the
volume changes prescribed by the input Jacobian map. Optionally, the
function can operate on a downsampled version of the image.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Requires a working installation of Simul&#64;atrophy.</p>
</div>
<p class="rubric">References</p>
<table class="docutils footnote" frame="void" id="id33" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id32">[7]</a></td><td>Khanal, Bishesh, Nicholas Ayache, and Xavier Pennec.
“Simulating Longitudinal Brain MRIs with Known Volume Changes
and Realistic Variations in Image Intensity.” Frontiers in
neuroscience 11 (2017): 132.</td></tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first">
<li><p class="first"><strong>jacobian</strong> (<em>sitk.Image</em>) – Jacobian map.</p>
</li>
<li><p class="first"><strong>mask</strong> (<em>sitk.Image</em>) – Binary mask marking the ROI whose Jacobian shall be matched.</p>
</li>
<li><p class="first"><strong>scale</strong> (<em>Tuple[float, float, float]</em>) – If not <code class="docutils literal notranslate"><span class="pre">None</span></code>, operate on an image downsampled by dividing
each size component by the given factors.</p>
</li>
<li><p class="first"><strong>sigma</strong> (<em>float</em>) – Amount of smoothing prior to resampling. Only relevant when
<code class="docutils literal notranslate"><span class="pre">scale</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</li>
<li><p class="first"><strong>lame</strong> (<em>Tuple[float, float, float, float]</em>) –</p>
<dl class="docutils">
<dt>Lamé parameters, in the following order:</dt>
<dd><ul class="first last simple">
<li><img class="math" src="images/math/d79e8a2c7ce54906c2b25549da38bdbe02cf40d6.png" alt="\mu"/> within the ROI</li>
<li><img class="math" src="images/math/d79e8a2c7ce54906c2b25549da38bdbe02cf40d6.png" alt="\mu"/> outside the ROI</li>
<li><img class="math" src="images/math/76f1d8ace30435987c01a00ca53a71cba1f40e6c.png" alt="\lambda"/> within the ROI</li>
<li><img class="math" src="images/math/76f1d8ace30435987c01a00ca53a71cba1f40e6c.png" alt="\lambda"/> outside the ROI</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><strong>origin</strong> (<em>Tuple[int, int, int]</em>) – If not <cite>None</cite> then only a region of the image is processed,
defined by origin and size. Requires to specify <code class="docutils literal notranslate"><span class="pre">size</span></code>.</p>
</li>
<li><p class="first"><strong>size</strong> (<em>Tuple[int, int, int]</em>) – If not <cite>None</cite> then only a region of the image is processed,
defined by origin and size. Requires to specify <code class="docutils literal notranslate"><span class="pre">origin</span></code>.</p>
</li>
<li><p class="first"><strong>executable</strong> (<em>str</em>) – Path to the Simul&#64;atrophy executable. If <cite>None</cite>, the executable
is searched within the system path.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A displacement field realising the volume changes of the given
Jacobian map.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">sitk.Image</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-disptools">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-disptools" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Martino Pilia.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <div style="padding-top: 1em;">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            <img alt="Creative Commons License" 
                 style="border-width:0"
                 src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
        </a>
        <br/>
        This documentation is freely available under the
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            Creative Commons Attribution-ShareAlike 4.0 International License
        </a>.
    </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>